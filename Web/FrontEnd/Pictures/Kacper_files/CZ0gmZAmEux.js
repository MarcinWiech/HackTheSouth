if (self.CavalryLogger) { CavalryLogger.start_js(["wO3Hq"]); }

__d("XBrowserPushDisabledController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/push/disabled/",{})}),null);
__d("XBrowserPushXOutController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/push/xout/",{})}),null);
__d("XServiceWorkerSessionChangeController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/service_workers/session/persist/",{})}),null);
__d("BrowserPushSessionChange.react",["cx","fbt","ix","AsyncRequest","BanzaiLogger","Image.react","ImageBlock.react","LayerFadeOnHide","React","ReloadPage","XBrowserPushDisabledController","XBrowserPushXOutController","XServiceWorkerSessionChangeController","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react","XUIDialogOkayButton.react","XUIDialogTitle.react","XUISpinner.react","XUIText.react"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);j=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=j.constructor).call.apply(a,[this].concat(e)),this.state={dialogShown:!0,spin:!1},this.$1=function(a){if(a)return;this.setState({dialogShown:!1});this.$2("session_keep");a=b("XServiceWorkerSessionChangeController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(a).setMethod("POST").setData({app_id:this.props.push.appID}).setAllowCrossPageTransition(!0).setHandler(function(a){this.props.onHide()}.bind(this)).send()}.bind(this),this.$3=function(){this.setState({spin:!0});this.$2("session_uninstall");this.$2("xout");var a=b("XBrowserPushXOutController").getURIBuilder().getURI(),c=function(){this.props.push.unregisterPushAndSW(b("XBrowserPushDisabledController"),b("AsyncRequest")).done(function(a){b("ReloadPage").now()})}.bind(this);new(b("AsyncRequest"))().setURI(a).setMethod("POST").setHandler(c).setAllowCrossPageTransition(!0).send()}.bind(this),c}a.prototype.$2=function(a){"use strict";a={event:a,appid:this.props.push.appID,surface:"session_change"};b("BanzaiLogger").log("BrowserPushLoggerConfig",a)};a.prototype.componentDidMount=function(){"use strict";this.$2("session_change_prompt")};a.prototype.render=function(){"use strict";if(!this.state.dialogShown)return null;var a=i("92724");return b("React").createElement(b("XUIDialog.react"),{shown:!0,behaviors:{LayerFadeOnHide:b("LayerFadeOnHide")},onToggle:this.$1,width:445,key:"dialog"},b("React").createElement(b("XUIDialogTitle.react"),null,h._("Desktop Notifications Are On")),b("React").createElement(b("XUIDialogBody.react"),null,this.state.spin?b("React").createElement(b("XUISpinner.react"),{size:"large"}):b("React").createElement(b("ImageBlock.react"),{spacing:"medium"},b("React").createElement(b("Image.react"),{src:a,alt:h._("Desktop Notifications Are On")}),b("React").createElement("div",null,b("React").createElement("div",{className:"_3-8h"},b("React").createElement(b("XUIText.react"),{size:"header3"},h._("When you get a new notification, you'll see it in the corner of your screen."))),b("React").createElement("div",{className:"_3-8h"},b("React").createElement(b("XUIText.react"),{size:"meta1"},h._("To be sure you get notifications, you'll now stay logged into Facebook on this computer. If you're using a public computer or don't want to stay logged in, click Undo to turn off desktop notifications.")))))),b("React").createElement(b("XUIDialogFooter.react"),null,b("React").createElement(b("XUIDialogButton.react"),{action:"button",label:h._("Undo"),onClick:this.$3}),b("React").createElement(b("XUIDialogOkayButton.react"),{use:"confirm",action:"cancel"})))};a.propTypes={onHide:c.func.isRequired,push:c.object.isRequired};e.exports=a}),null);
__d("MockChromeBrowserNotification.react",["cx","fbt","ix","BrowserPushStrings","DOMContainer.react","Image.react","React","WorkModeConfig","isNode","joinClasses"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;j=babelHelpers.inherits(a,b("React").Component);j&&j.prototype;a.prototype.render=function(){var a=b("isNode")(this.props.message)?b("React").createElement(b("DOMContainer.react"),null,this.props.message):this.props.message,c=!this.props.image&&b("WorkModeConfig").is_work_user,d=this.props.image?this.props.image:this.props.defaultImage;return b("React").createElement("section",{className:b("joinClasses")(this.props.className,"_257o")},b("React").createElement("span",{className:"_61kd"}),b("React").createElement(b("Image.react"),{className:(c?"":"_ega")+(c?" _2rk4":""),draggable:!1,src:d}),b("React").createElement("div",{className:"_egb"},b("React").createElement("h3",null,b("BrowserPushStrings").title),b("React").createElement("p",null,a),b("React").createElement("cite",null,window.location.hostname)))};function a(){j.apply(this,arguments)}a.defaultProps={message:h._("You have new notifications."),defaultImage:b("WorkModeConfig").is_work_user?i("351290"):i("76304")};e.exports=a}),null);
__d("MockEdgeBrowserNotification.react",["cx","fbt","ix","BrowserPushStrings","DOMContainer.react","Image.react","React","WorkModeConfig","isNode","joinClasses"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;j=babelHelpers.inherits(a,b("React").Component);j&&j.prototype;a.prototype.render=function(){var a=b("isNode")(this.props.message)?b("React").createElement(b("DOMContainer.react"),null,this.props.message):this.props.message,c=h._("Microsoft Edge");return b("React").createElement("section",{className:b("joinClasses")(this.props.className,"_2eed")},b("React").createElement(b("Image.react"),{className:(b("WorkModeConfig").is_work_user?"":"_2eee")+(b("WorkModeConfig").is_work_user?" _3_qv":""),draggable:!1,src:this.props.image}),b("React").createElement("div",{className:"_2eef"},b("React").createElement("h3",{className:"_2eeg"},b("BrowserPushStrings").title),b("React").createElement("p",{className:"_2eeh"},a),b("React").createElement("div",{className:"_2eei"},c," \xb7 ",window.location.hostname)))};function a(){j.apply(this,arguments)}a.defaultProps={message:h._("You have new notifications."),image:b("WorkModeConfig").is_work_user?i("351290"):i("363137")};e.exports=a}),null);
__d("MockFirefoxBrowserNotification.react",["cx","fbt","ix","BrowserPushStrings","DOMContainer.react","Image.react","React","WorkModeConfig","isNode","joinClasses"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;j=babelHelpers.inherits(a,b("React").Component);j&&j.prototype;a.prototype.render=function(){var a=b("isNode")(this.props.message)?b("React").createElement(b("DOMContainer.react"),null,this.props.message):this.props.message,c=this.props.isWindows;return b("React").createElement("section",{className:b("joinClasses")(this.props.className,"_g5o")},c?this.$1(a):this.$2(a))};a.prototype.$2=function(a){return b("React").createElement("div",{className:"_g5p"},b("React").createElement("div",{className:"_g5q"},b("React").createElement(b("Image.react"),{draggable:!1,src:i("355144")})),b("React").createElement("div",{className:"_g5r"},b("React").createElement("h3",null,b("BrowserPushStrings").title),b("React").createElement("cite",null,window.location.hostname),b("React").createElement("p",null,a)),b("React").createElement(b("Image.react"),{className:(b("WorkModeConfig").is_work_user?"":"_g5u")+(b("WorkModeConfig").is_work_user?" _gcl":""),draggable:!1,src:this.props.image}))};a.prototype.$1=function(a){return b("React").createElement("div",{className:"_g5w"},b("React").createElement("h3",null,b("BrowserPushStrings").title),b("React").createElement("div",{className:"_g5x"},b("React").createElement("span",{className:"_g5z"}),b("React").createElement("span",{className:"_g7w"})),b("React").createElement("div",{className:"_g5r"},b("React").createElement(b("Image.react"),{className:(b("WorkModeConfig").is_work_user?"":"_g5u")+(b("WorkModeConfig").is_work_user?" _gcl":""),draggable:!1,src:this.props.image}),b("React").createElement("div",{className:"_g7x"},b("React").createElement("p",null,a),b("React").createElement("cite",null,window.location.hostname))))};function a(){j.apply(this,arguments)}a.defaultProps={message:h._("You have new notifications."),image:b("WorkModeConfig").is_work_user?i("351290"):i("363137"),isWindows:!1};e.exports=a}),null);
__d("MockBrowserNotification.react",["MockChromeBrowserNotification.react","MockEdgeBrowserNotification.react","MockFirefoxBrowserNotification.react","React","UserAgent"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){var c=b("UserAgent").isPlatform("Windows");if(b("UserAgent").isBrowser("Firefox"))return b("React").createElement(b("MockFirefoxBrowserNotification.react"),babelHelpers["extends"]({},a,{isWindows:c}));else if(b("UserAgent").isBrowser("Edge"))return b("React").createElement(b("MockEdgeBrowserNotification.react"),a);return b("React").createElement(b("MockChromeBrowserNotification.react"),babelHelpers["extends"]({},a,{isWindows:c}))}}),null);
__d("NotificationPermissionNotice.react",["cx","fbt","Event","Keys","React","XUIAmbientNUX.react"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i,j=[];c=b("React").PropTypes;i=babelHelpers.inherits(a,b("React").Component);i&&i.prototype;a.prototype.componentDidMount=function(){"use strict";j.push(b("Event").listen(window,"mousedown",this.props.onHide)),j.push(b("Event").listen(window,"keydown",function(a){a.keyCode===b("Keys").ESC&&this.props.onHide()}.bind(this)))};a.prototype.componentWillUnmount=function(){"use strict";while(j.length>0){var a=j.pop();a.remove()}};a.prototype.renderLayers=function(){"use strict";var a=this.props.shortText?h._("Click the lock to give {browser_name} permission to send you desktop notifications.",[h._param("browser_name",this.props.browserName)]):h._("If you change your mind, click the lock to give {browser_name} permission to send you desktop notifications.",[h._param("browser_name",this.props.browserName)]);return b("React").createElement(b("XUIAmbientNUX.react"),{contextRef:function(){return this.refs.noticeAnchor}.bind(this),shown:!0,position:"below",onCloseButtonClick:this.props.onHide,key:"nux"},a)};a.prototype.render=function(){"use strict";return b("React").createElement("span",null,b("React").createElement("span",{ref:"noticeAnchor",className:"_1_i1"}),this.renderLayers())};function a(){"use strict";i.apply(this,arguments)}a.propTypes={onHide:c.func.isRequired,shortText:c.bool,browserName:c.string.isRequired};e.exports=a}),null);
__d("Spotlight",["csx","cx","Arbiter","ArbiterMixin","DOM","JSXDOM","Layer","LayerAutoFocus","LayerButtons","LayerTabIsolation","ModalLayer","Vector","classWithMixins","joinClasses","mixin"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i;c=babelHelpers.inherits(a,b("classWithMixins")(b("Layer"),b("mixin")(b("ArbiterMixin"))));i=c&&c.prototype;function a(a,c){"use strict";i.constructor.call(this,a,c),this.stageMinSize=new(b("Vector"))(0,0),this.stagePadding=new(b("Vector"))(0,0)}a.prototype._buildWrapper=function(a,c){"use strict";a=b("joinClasses")("_n8"+(a.wash==="dark"||!a.wash?" _3qx":"")+(a.wash==="xui"?" _4-hy":""),a.rootClassName);return b("JSXDOM").div({className:a},b("JSXDOM").div({className:"_n9"},c))};a.prototype._getDefaultBehaviors=function(){"use strict";return i._getDefaultBehaviors.call(this).concat([j,b("LayerAutoFocus"),b("LayerButtons"),b("LayerTabIsolation"),b("ModalLayer")])};a.prototype.getContentRoot=function(){"use strict";this._content||(this._content=b("DOM").find(this.getRoot(),"div._n3"));return this._content};a.prototype.configure=function(a){"use strict";a.stageMinSize&&(this.stageMinSize=a.stageMinSize),a.stagePadding&&(this.stagePadding=a.stagePadding)};a.prototype.onContentLoaded=function(){"use strict";this.inform("content-load")};a.prototype.updatePermalink=function(a){"use strict";this.inform("permalinkchange",a)};Object.assign(a.prototype,{stageMinSize:null,stagePadding:null});function j(a){"use strict";this._layer=a}j.prototype.enable=function(){"use strict";this._subscription=this._layer.subscribe(["show","hide"],function(a,c){a==="show"?b("Arbiter").inform("layer_shown",{type:"Spotlight"}):b("Arbiter").inform("layer_hidden",{type:"Spotlight"})})};j.prototype.disable=function(){"use strict";this._subscription.unsubscribe(),this._subscription=null};Object.assign(j.prototype,{_subscription:null});e.exports=a}),null);
__d("Spotlight.react",["LayerAutoFocusReact","LayerHideOnBlur","LayerHideOnEscape","LayerRefocusOnHide","React","ReactLayer","Spotlight"],(function(a,b,c,d,e,f){__p&&__p();a=b("React").PropTypes;c=b("ReactLayer").createClass({propTypes:{causalElement:a.instanceOf(HTMLElement),onHide:a.func,rootClassName:a.string,shown:a.bool,wash:a.oneOf(["light","xui","dark"])},getDefaultEnabledBehaviors:function(){return{hideOnBlur:b("LayerHideOnBlur"),hideOnEscape:b("LayerHideOnEscape"),refocusOnHide:b("LayerRefocusOnHide"),autoFocus:b("LayerAutoFocusReact")}},createLayer:function(a){var c=this.enumerateBehaviors(this.props.behaviors);c={addedBehaviors:c,rootClassName:this.props.rootClassName,wash:this.props.wash};c=new(b("Spotlight"))(c,a);c.setCausalElement(this.props.causalElement);c.conditionShow(this.props.shown);this.props.onBeforeHide&&c.subscribe("beforehide",this.props.onBeforeHide);this.props.onHide&&c.subscribe("hide",this.props.onHide);return c},receiveProps:function(a){this.layer&&(this.layer.setCausalElement(a.causalElement),this.layer.conditionShow(a.shown))}});e.exports=c}),null);
__d("NotificationPermissionRequest.react",["cx","React","Spotlight.react"],(function(a,b,c,d,e,f,g){__p&&__p();var h;c=b("React").PropTypes;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.render=function(){"use strict";return b("React").createElement(b("Spotlight.react"),{shown:!0,onHide:this.props.onHide,key:"spotlight"},b("React").createElement("div",{className:"_n3"}))};function a(){"use strict";h.apply(this,arguments)}a.propTypes={onHide:c.func};e.exports=a}),null);
__d("NotificationPermissionRequestWithPreview.react",["cx","fbt","ix","BrowserPushStrings","Image.react","ImageBlock.react","MockBrowserNotification.react","React","Spotlight.react","XUIAmbientNUX.react","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react","XUIDialogTitle.react"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k=function(a){var c;return b("React").createElement(b("Spotlight.react"),{onHide:a.onHide,shown:a.shown,wash:"xui"},b("React").createElement("span",{ref:function(a){return c=a},className:"_m4w"}),b("React").createElement("div",{className:"_n3"},b("React").createElement(b("XUIAmbientNUX.react"),{contextRef:function(){return c},key:"nux",shown:a.shown,onCloseButtonClick:a.onHide,position:"below"},b("React").createElement("strong",null,h._("Almost Done!")),b("React").createElement("br",null),h._("Now, click \"Allow\" to finish activating notifications."))))};c=babelHelpers.inherits(a,b("React").Component);j=c&&c.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=j.constructor).call.apply(a,[this].concat(d)),this.state={acceptPromptShown:!1,dialogShown:!0,spinnerShown:!1},this.$2=function(a){this.setState({dialogShown:a})}.bind(this),this.$3=function(){this.setState({acceptPromptShown:!this.props.hideSecondStep&&!this.props.showSpinnerWhileRequesting,dialogShown:this.props.showSpinnerWhileRequesting,spinnerShown:!this.props.hideSecondStep&&this.props.showSpinnerWhileRequesting}),this.props.onAccept&&this.props.onAccept(this.$4)}.bind(this),this.$4=function(){this.$1&&this.setState({acceptPromptShown:!1,dialogShown:!1})}.bind(this),this.$5=function(){this.setState({acceptPromptShown:!1})}.bind(this),b}a.prototype.UNSAFE_componentWillMount=function(){this.$1=!0};a.prototype.componentWillUnmount=function(){this.$1=!1};a.prototype.render=function(){var a=this.props,c=a.notificationImage;a=a.notificationMessage;c=b("React").createElement(b("MockBrowserNotification.react"),{className:"_m4x",image:c,message:a});a=this.state.spinnerShown?b("React").createElement(b("XUIDialogBody.react"),{className:"_mjv"},b("React").createElement(b("ImageBlock.react"),{spacing:"large"},b("React").createElement(b("Image.react"),{draggable:!1,src:i("287648"),width:40,height:40,className:"_mjw"}),b("React").createElement("div",null,b("React").createElement("strong",null,h._("Almost Done!")),b("React").createElement("p",{className:"_mjx"},h._("Now, click \"Allow\" to finish activating notifications."))))):b("React").createElement(b("XUIDialogBody.react"),{className:"_mjy"},b("React").createElement(b("ImageBlock.react"),{spacing:"large"},b("React").createElement(b("Image.react"),{draggable:!1,src:i("287648"),className:"_mjw"}),b("React").createElement("div",null,this.props.isWebNotifications?b("BrowserPushStrings").explanation_web_notifications:b("BrowserPushStrings").explanation)),c);c=this.state.spinnerShown?null:b("React").createElement(b("XUIDialogFooter.react"),null,b("React").createElement(b("XUIDialogButton.react"),{action:"cancel",label:h._("Not Now"),onClick:this.props.onClose}),b("React").createElement(b("XUIDialogButton.react"),{action:"button",label:h._("Turn On"),onClick:this.$3,use:"special"}));return b("React").createElement("div",{className:"_m4y"},b("React").createElement(b("XUIDialog.react"),{layerHideOnBlur:!1,onToggle:this.$2,shown:this.state.dialogShown,titleID:"notification-permission-title",width:445},b("React").createElement(b("XUIDialogTitle.react"),{showCloseButton:!1},b("React").createElement("span",{id:"notification-permission-title"},b("BrowserPushStrings").turn_on)),a,c),b("React").createElement(k,{shown:this.state.acceptPromptShown,onHide:this.$5}))};e.exports=a}),null);
__d("BrowserPushCommands",[],(function(a,b,c,d,e,f){a="browser_push_ack";b="browser_push_redirect";c="browser_push_window_visible";d={ACK:a,REDIRECT:b,WINDOW_VISIBLE:c};e.exports=d}),null);
__d("BrowserPushMessageRedirectUtil",["Bootloader"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){var c="(messages)(.*?)(?:(tid=))([^&]*)";a=a.match(c);if(!a)return!0;var d=a.pop();b("Bootloader").loadModules(["FantaTabActions"],function(a){a.openTab(d)},"BrowserPushMessageRedirectUtil");return!1};e.exports=a}),null);
__d("BrowserPushMessageHandler",["BrowserPushCommands","BrowserPushMessageRedirectUtil","EventListener","URI","URISchemes","isFacebookURI"],(function(a,b,c,d,e,f){__p&&__p();function g(a){__p&&__p();if(a.data.command&&a.data.command===b("BrowserPushCommands").REDIRECT){if(window.onbeforeunload()===void 0)a.ports[0].postMessage({command:b("BrowserPushCommands").ACK,success:!0});else{a.ports[0].postMessage({command:b("BrowserPushCommands").ACK,success:!1});return}a=a.data.uri;if(/^([^.:/?#]+):/.test(a)&&!b("URISchemes").isAllowed(/^([^.:/?#]+):/.exec(a)[1])||!b("isFacebookURI")(new(b("URI"))(a)))throw new Error("goURI: URI scheme rejected, URI: "+a);b("BrowserPushMessageRedirectUtil")(a)&&(window.location.href=a)}}a={registerRedirectHandler:function(){b("EventListener").listen(window,"message",function(a){a.origin===""&&g(a)}),navigator.serviceWorker&&navigator.serviceWorker.addEventListener&&navigator.serviceWorker.addEventListener("message",function(a){(navigator.serviceWorker&&navigator.serviceWorker.controller&&a.target&&a.target.controller&&a.target.controller===navigator.serviceWorker.controller||new RegExp("^"+window.location.protocol+"//"+window.location.host+"$").test(a.origin))&&g(a)})}};e.exports=a}),null);
__d("BrowserPushMuteOptions",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({ZERO:0,FIFTEEN_MINUTES:900,THIRTY_MINUTES:1800,FORTY_FIVE_MINUTES:2700,ONE_HOUR:3600,TWO_HOURS:7200,EIGHT_HOURS:28800,ONE_DAY:86400})}),null);
__d("BrowserPushVisibilityChanger",["BrowserPushCommands","ClientServiceWorkerMessage","Visibility"],(function(a,b,c,d,e,f){function g(){new(b("ClientServiceWorkerMessage"))(b("BrowserPushCommands").WINDOW_VISIBLE,null).sendViaController()}a={listenForVisibility:function(){b("Visibility").isHidden()||g(),b("Visibility").addListener(b("Visibility").VISIBLE,g)}};e.exports=a}),null);
__d("PushRegistrationUtils",[],(function(a,b,c,d,e,f){"use strict";var g={normalizeSubscriptionEndpoint:function(a){var b=a.endpoint;"subscriptionId"in a&&!new RegExp("/"+a.subscriptionId+"$").test(b)&&(b+="/"+a.subscriptionId);return b},setupPushRegistrationData:function(a,b){var c=g.normalizeSubscriptionEndpoint(a),d=null;a.toJSON?d=a.toJSON().keys:a.keys&&(d=a.keys);return{app_id:b,push_endpoint:c,subscription_keys:JSON.stringify(d)}}};e.exports=g}),null);
__d("XAsyncPushMuteController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/settings/push/mute/",{appid:{type:"Int",required:!0},push_endpoint:{type:"String",required:!0},mute_for:{type:"Enum",enumType:0}})}),null);
__d("XAsyncPushMuteStateController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/settings/push/mute/state/",{appid:{type:"Int",required:!0},push_endpoint:{type:"String",required:!0}})}),null);
__d("PushRegistration",["Promise","BrowserPushMessageHandler","BrowserPushMuteOptions","BrowserPushVisibilityChanger","PushRegistrationUtils","ServiceWorkerRegistration","XAsyncPushMuteController","XAsyncPushMuteStateController","emptyFunction","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g=window.Notification,h=new Map();i.get=function(a,b){"use strict";if(h.has(b))return h.get(b);a=new i(a,b);h.set(b,a);return a};function i(a,b){"use strict";this.$3=a,this.appID=b,!i.$1&&!i.$2&&(i.$1=!1,i.$2=!1)}i.prototype.getPushSubscription=function(){"use strict";return new(b("Promise"))(function(a,c){i.pushPermissionIsDenied()&&c(new Error("No permission or not supported")),b("ServiceWorkerRegistration").getWorkerRegistration(this.$3).then(function(b){if(!b){a(null);return}b.pushManager.getSubscription().then(function(b){a(b)})["catch"](c)})["catch"](c)}.bind(this))};i.prototype.$4=function(a,c,d,e){"use strict";a=a.getURIBuilder().getURI();c=new c(a);c.setData(b("PushRegistrationUtils").setupPushRegistrationData(d,this.appID));c.setMethod("post");c.setHandler&&c.setHandler(function(a){a.payload&&a.payload.session_change&&e()});c.send()};i.prototype.getMutedUntilInServer=function(a){"use strict";__p&&__p();return new(b("Promise"))(function(c,d){__p&&__p();this.getPushSubscription().then(function(e){if(e){e=b("PushRegistrationUtils").normalizeSubscriptionEndpoint(e);e=b("XAsyncPushMuteStateController").getURIBuilder().setString("push_endpoint",e).setInt("appid",this.appID).getURI();e=new a(e);e.listen("done",function(a){c(a.payload.muteUntilTimestampSec)});e.send()}else d("cannot check mute status for unsubscribed endpoint")}.bind(this))["catch"](d)}.bind(this))};i.prototype.muteNotifications=function(a,c){"use strict";__p&&__p();return new(b("Promise"))(function(d,e){__p&&__p();this.getPushSubscription().then(function(f){__p&&__p();if(f){f=b("PushRegistrationUtils").normalizeSubscriptionEndpoint(f);f=b("XAsyncPushMuteController").getURIBuilder().setEnum("mute_for",a).setString("push_endpoint",f).setInt("appid",this.appID).getURI();f=new c(f);f.setMethod("POST");f.listen("done",function(c){a!==b("BrowserPushMuteOptions").ZERO&&c.payload.muteUntilTimestampSec===0?e("operation failed in server"):d(c.payload.muteUntilTimestampSec)});f.send()}else e("no subscription found")}.bind(this))["catch"](e)}.bind(this))};i.prototype.getSubscription=function(){"use strict";return new(b("Promise"))(function(a,c){this.getPushSubscription().then(function(c){c?a(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(c)):a(null)})["catch"](c)}.bind(this))};i.prototype.maybeRegisterPushAgain=function(a,c,d){"use strict";return new(b("Promise"))(function(e,f){this.getPushSubscription().then(function(f){f?(this.$4(a,c,f,d),e(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(f))):e(null)}.bind(this))["catch"](function(){e(null)})}.bind(this))};i.prototype.$5=function(a,c,d){"use strict";__p&&__p();return new(b("Promise"))(function(b,e){__p&&__p();if(i.$2&&!d){e(new Error("sending disable info already"));return}i.$2=!0;var f=a.getURIBuilder().getURI();f=new c(f.toString());f.setData({appid:this.appID,from_browser_settings:d});f.setMethod("post");f.listen?(f.listen("finally",b),f.listen("fail",function(){i.$2=!1,e()})):f.setErrorHandler&&f.setHandler?(f.setErrorHandler(function(){i.$2=!1,e()}),f.setHandler(b)):b();f.send()}.bind(this))};i.prototype.isPushRegistered=function(a,c,d,e,f,g,h){f===void 0&&(f=!1);g===void 0&&(g=b("emptyFunction"));h===void 0&&(h=!1);b("BrowserPushMessageHandler").registerRedirectHandler();return new(b("Promise"))(function(j,k){this.getPushSubscription().then(function(k){j(!!k||a&&!i.pushPermissionIsPending()),k?f?this.$4(c,e,k,g):b("BrowserPushVisibilityChanger").listenForVisibility():!k&&a&&(i.pushPermissionIsOn()?this.registerPush(c,e,g,h)["catch"](function(){}):this.$5(d,e,!1))}.bind(this))["catch"](function(){a&&this.$5(d,e,!1),h&&b("ServiceWorkerRegistration").unregisterControllingWorker(),k()}.bind(this))}.bind(this))};i.prototype.$6=function(){"use strict";return new(b("Promise"))(function(a,b){g.requestPermission(a)})};i.prototype.registerPushAndWaitForEndpoint=function(a,c,d,e){"use strict";return new(b("Promise"))(function(b,f){this.$7(a,c,d,!0,null,e).then(function(a){if(typeof a!=="string"){f(new Error("registerPushImpl did not return an endpoint"));return}b(a)})["catch"](f)}.bind(this))};i.prototype.registerPushOnKaiOS=function(a,c,d){"use strict";return new(b("Promise"))(function(e,f){d.waitForKaiOS().done(function(){d.registerPush(function(d){d=JSON.parse(d.get("push_endpoint"));this.$4(a,c,d,b("emptyFunction"));e(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(d))}.bind(this))}.bind(this))}.bind(this))};i.prototype.registerPush=function(a,c,d,e,f){d===void 0&&(d=b("emptyFunction"));e===void 0&&(e=!1);f===void 0&&(f=b("emptyFunction"));return this.registerPushWithFinishedCallBack(a,c,d,f,e)};i.prototype.registerPushWithFinishedCallBack=function(a,c,d,e,f){"use strict";return new(b("Promise"))(function(b,g){this.$7(a,c,d,!1,e,f).then(function(a){if(typeof a!=="boolean"){g(new Error("registerPushImpl did not return a boolean"));return}b(a)})["catch"](g)}.bind(this))};i.prototype.$7=function(a,c,d,e,f,g){"use strict";__p&&__p();if(i.$1)return new(b("Promise"))(function(a,b){b(new Error("registering already"))});if(!self.PushManager)return b("Promise").reject(new Error("PushManager not found."));i.$1=!0;return new(b("Promise"))(function(h,j){__p&&__p();var k=b("ServiceWorkerRegistration").registerWorkerIfUnregistered(this.$3),l=this.$6();b("Promise").all([k,l]).then(function(k){var l=k[0];if(!i.pushPermissionIsOn()){g&&l.unregister();throw new Error("Push permission was denied")}e||h(!0);l.pushManager.subscribe({userVisibleOnly:!0}).then(function(g){e&&h(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(g)),this.$4(a,c,g,d),f&&f(),b("BrowserPushVisibilityChanger").listenForVisibility()}.bind(this))["catch"](function(a){i.$1=!1,g&&l.unregister(),j(a)})}.bind(this))["catch"](function(a){i.$1=!1,j(a)})}.bind(this))};i.prototype.unregisterPushAndSWOnKaiOS=function(a,c,d,e){"use strict";return new(b("Promise"))(function(b,f){this.$5(a,c,e).then(function(){d.unregisterPush(),b()})["catch"](f)}.bind(this))};i.prototype.unregisterPushAndSW=function(a,c){"use strict";return new(b("Promise"))(function(d,e){this.$5(a,c,!0).then(function(){b("promiseDone")(b("ServiceWorkerRegistration").unregisterControllingWorker(),d)})["catch"](e)}.bind(this))};i.prototype.unregisterPushOnly=function(a,c){"use strict";return new(b("Promise"))(function(b,d){this.getPushSubscription().then(function(e){e?e.unsubscribe().then(this.$5(a,c,!0)).then(function(){b(!0)})["catch"](d):d()}.bind(this))["catch"](d)}.bind(this))};i.pushPermissionIsPending=function(){"use strict";return window.Notification&&window.Notification.permission==="default"};i.pushPermissionIsOn=function(){"use strict";return window.Notification&&window.Notification.permission==="granted"};i.pushPermissionIsDenied=function(){"use strict";return window.Notification&&window.Notification.permission==="denied"};e.exports=i}),null);
__d("XBrowserWebNotificationsEnableController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/web_notifications/enable/",{})}),null);
__d("XPushRegisterServiceWorkerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/push/register/service_worker/",{})}),null);
__d("incognito",["regeneratorRuntime","Promise","UserAgent","WebStorage","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){__p&&__p();var a;return b("regeneratorRuntime").async(function(c){__p&&__p();while(1)switch(c.prev=c.next){case 0:a=window.RequestFileSystem||window.webkitRequestFileSystem;if(!a){c.next=3;break}return c.abrupt("return",new(b("Promise"))(function(b){return a(window.TEMPORARY,10,function(){return b(!1)},function(){return b(!0)})}));case 3:if(!(b("UserAgent").isBrowser("IE >= 10")||b("UserAgent").isBrowser("Edge"))){c.next=5;break}return c.abrupt("return",!window.indexedDB);case 5:if(!b("UserAgent").isBrowser("Firefox >= 16")){c.next=7;break}return c.abrupt("return",new(b("Promise"))(function(a){var b=window.indexedDB.open("__test__");b.onsuccess=function(){return a(!1)};b.onerror=function(b){b.preventDefault(),a(!0)}}));case 7:if(!(b("gkx")("676917")&&(b("UserAgent").isPlatform("iOS")&&b("UserAgent").isBrowser("Safari >= 10.3")||b("UserAgent").isPlatform("Mac OS X")&&b("UserAgent").isBrowser("Safari >= 11.1")))){c.next=18;break}c.prev=8;window.openDatabase("sid","1.0","",0);c.next=16;break;case 12:c.prev=12;c.t0=c["catch"](8);if(!(c.t0.name==="SecurityError")){c.next=16;break}return c.abrupt("return",!0);case 16:c.next=20;break;case 18:if(!b("UserAgent").isBrowser("Safari")){c.next=20;break}return c.abrupt("return",!b("WebStorage").getLocalStorage());case 20:return c.abrupt("return",!1);case 21:case"end":return c.stop()}},null,this,[[8,12]])}e.exports=a}),null);
__d("BrowserPushDirectPromptInstaller",["Promise","Arbiter","AsyncRequest","BanzaiLogger","Bootloader","BrowserPushSessionChange.react","CrossWindowEventEmitter","DOM","NotificationPermissionNotice.react","NotificationPermissionRequest.react","NotificationPermissionRequestWithPreview.react","PushRegistration","QE2Logger","React","ReactDOM","XBrowserPushDisabledController","XBrowserPushXOutController","XBrowserWebNotificationsEnableController","XPushRegisterServiceWorkerController","incognito","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=window.Notification,h=new(b("CrossWindowEventEmitter"))("BrowserPushInstall"),i={},j,k=!1;function l(a,c){a=babelHelpers["extends"]({event:a,appid:c,surface:"prompt"},i);b("BanzaiLogger").log("BrowserPushLoggerConfig",a)}function m(){i.xout_count===0&&j&&b("QE2Logger").logExposureForUser(j)}function n(a){var c=b("XBrowserPushXOutController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setMethod("POST").send();l("xout",a)}function o(a){var c=b("XBrowserWebNotificationsEnableController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setMethod("POST").send();b("Arbiter").inform("WebNotifications/enabled");h.emitRemote("complete");b("Bootloader").loadModules(["WebNotificationsPresenter"],function(b){b.init(a.toString())},"BrowserPushDirectPromptInstaller")}function p(a){k||(k=!0,b("ReactDOM").unmountComponentAtNode(a))}function q(a,c){var d=b("DOM").insertBefore(a,b("DOM").create("span"));d=d.pop();b("ReactDOM").render(b("React").createElement(b("BrowserPushSessionChange.react"),{onHide:function(){b("ReactDOM").unmountComponentAtNode(a)},push:c}),d)}function r(a,c,d,e,f){var g=b("PushRegistration").get(a,c);l("turn_on",c);return g.registerPushWithFinishedCallBack(b("XPushRegisterServiceWorkerController"),b("AsyncRequest"),function(){q(d,g)},function(){b("Arbiter").inform("BrowserPushInstall/installed")},f).then(function(){p(d),l("install",c)})["catch"](function(a){p(d),b("PushRegistration").pushPermissionIsDenied()?(b("ReactDOM").render(b("React").createElement(b("NotificationPermissionNotice.react"),{onHide:function(){b("ReactDOM").unmountComponentAtNode(d)},browserName:e}),d),l("deny",c)):l("install_ignore",c),n(c)})}a={setLogExtraData:function(a){i=a},setQEUniverseName:function(a){j=a},requestThenInstallWebNotifications:function(a,b,c,d,e,f){m(),this._showRequestPermissions({appID:a,baseElement:b,browserName:c,hasEnoughFriendsToRequestPush:d,sampleNotificationAvatarURI:f,sampleNotificationMessage:e,showSpinnerWhileRequesting:!0,isWebNotifications:!0,onAcceptCallback:this._getOnWebNotificationsDialogAccept({appID:a,callback:function(c){c==="granted"?(l("install",a),h.emitRemote("complete"),p(b),o(a)):(l("deny",a),n(a))}})})},requestThenInstallPush:function(a,c,d,e,f,g,h,i,j,k,l,n,o){__p&&__p();var p=b("PushRegistration").get(a,c);e=p.isPushRegistered(e,b("XPushRegisterServiceWorkerController"),b("XBrowserPushDisabledController"),b("AsyncRequest"),!!g,function(){q(d,p)},i);b("Promise").all([e,b("incognito")()]).then(function(e){var g=e[0];e=e[1];if(g||e)return;m();b("PushRegistration").pushPermissionIsPending()?this._showRequestPermissions({appID:c,baseElement:d,hasEnoughFriendsToRequestPush:j,isWebNotifications:!1,onAcceptCallback:this._getOnPushNotificationsAccept({appID:c,baseElement:d,browserName:h,path:a,workerIsForPushOnly:i}),sampleNotificationAvatarURI:l,sampleNotificationMessage:k,showSpinnerWhileRequesting:n,wasXOuted:f,hideSecondStep:o}):!f&&b("PushRegistration").pushPermissionIsOn()&&r(a,c,d,h,i)}.bind(this))["catch"](function(){b("PushRegistration").pushPermissionIsDenied()&&m()})},installPush:function(a,c,d,e,f,g,h,i,j){__p&&__p();var k=b("PushRegistration").get(a,c);e=k.isPushRegistered(e,b("XPushRegisterServiceWorkerController"),b("XBrowserPushDisabledController"),b("AsyncRequest"),!!g,function(){q(d,k)},i);b("Promise").all([e,b("incognito")()]).then(function(e){__p&&__p();var g=e[0];e=e[1];if(g||e)return;m();if(b("PushRegistration").pushPermissionIsPending()){if(!j||f)return;b("ReactDOM").render(b("React").createElement(b("NotificationPermissionRequest.react"),{onHide:function(){p(d)}}),d);r(a,c,d,h,i)}else f||r(a,c,d,h,i)})["catch"](function(){b("PushRegistration").pushPermissionIsDenied()&&m()})},_showRequestPermissions:function(a){var c=a.appID,d=a.baseElement,e=a.hasEnoughFriendsToRequestPush,f=a.isWebNotifications,g=a.onAcceptCallback,i=a.sampleNotificationAvatarURI,j=a.sampleNotificationMessage,k=a.showSpinnerWhileRequesting,m=a.wasXOuted;a=a.hideSecondStep;h.once("complete",function(a){p(d),l("twostep_suppressed",c)});if(!e||m)return;l("twostep_request",c);b("ReactDOM").render(b("React").createElement(b("NotificationPermissionRequestWithPreview.react"),{isWebNotifications:f,notificationImage:i||void 0,notificationMessage:j||void 0,onAccept:g,onClose:function(){l("twostep_notnow",c),h.emitRemote("complete"),n(c),p(d)},showSpinnerWhileRequesting:k,hideSecondStep:a}),d)},_getOnPushNotificationsAccept:function(a){var c=a.appID,d=a.baseElement,e=a.browserName,f=a.callback,g=a.path,i=a.workerIsForPushOnly;return function(){l("twostep_accept",c),h.emitRemote("complete"),b("promiseDone")(r(g,c,d,e,i).then(f,f))}},_getOnWebNotificationsDialogAccept:function(a){var b=a.appID,c=a.callback;return function(){l("twostep_accept",b),this._requestWebNotificationsFromBrowser(b,c)}.bind(this)},_requestWebNotificationsFromBrowser:function(a,b){l("turn_on",a),g.requestPermission(b)}};e.exports=a}),null);