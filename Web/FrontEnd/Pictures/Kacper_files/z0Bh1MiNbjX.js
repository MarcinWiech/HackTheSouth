if (self.CavalryLogger) { CavalryLogger.start_js(["CyUPO"]); }

__d("VideoVODCVCFetchingQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(){__p&&__p();var a;a=babelHelpers.inherits(c,b("WebGraphQLQueryBase"));a&&a.prototype;c.__getDocID=function(){"use strict";return"1918447051537934"};c.getQueryID=function(){"use strict";return"310269563033462"};function c(){"use strict";a.apply(this,arguments)}return c}()}),null);
__d("VideoVODCVCFetching",["Run","SubscriptionsHandler","VideoSocialFabricCVCExperiments","VideoVODCVCFetchingQueryWebGraphQLQuery","VODPresenceCVCDisplayStage","WebGraphQL","clearTimeout","keyMirror","promiseDone","setTimeout"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("keyMirror")(b("VODPresenceCVCDisplayStage")),h="vod_cvc/",i=1e4;function a(a){__p&&__p();this.$1=null;this.$4=null;this.$5=null;this.$6=i;this.$7=!1;this.$12=function(){this.$7=!0,b("clearTimeout")(this.$5)}.bind(this);if(!b("VideoSocialFabricCVCExperiments").isCVCPolledByGraphQL&&!b("VideoSocialFabricCVCExperiments").isCVCDisplayEnabled||a.isAd()||a.isLiveVideo())return;b("VideoSocialFabricCVCExperiments").isCVCPulledPreenter&&this.$10(a,g.PRE_ENTER);this.$8=a;a.registerOption("VideoVODCVCFetching","cvcData",function(){return this.$1}.bind(this));this.$2=new(b("SubscriptionsHandler"))();this.$2.addSubscriptions(a.addListener("beginPlayback",function(){this.$4=null}.bind(this)),a.addListener("updateStatus",function(b){a.isState("playing")&&(this.$4===null&&(this.$4=b.position),this.$4+3<=b.position&&(this.$4=Infinity,this.$11(a)))}.bind(this)),a.addListener("pausePlayback",this.$12),a.addListener("finishPlayback",function(){return!a.getOption("Looping","isLooping")&&this.$12()}.bind(this)),a.addListener("becomeInvisible",this.$12));b("Run").onLeave(function(){return this.cleanOnLeave()}.bind(this))}a.prototype.cleanOnLeave=function(){this.$2&&this.$2.release(),this.$12(),this.$8&&this.$8.hasOption("VideoVODCVCFetching","cvcData")&&this.$8.unregisterOption("VideoVODCVCFetching","cvcData")};a.prototype.$11=function(a){this.$7=!1,this.$10(a,g.POST_ENTER)};a.prototype.getQuery=function(a,c,d,e){return new(b("VideoVODCVCFetchingQueryWebGraphQLQuery"))({video_id:a.getVideoID(),stage:c,video_asset_id:d,prev_cvc:e})};a.prototype.$10=function(a,c){__p&&__p();var d;d=b("WebGraphQL").exec(this.getQuery(a,c,this.$9,(d=this.$1)==null?void 0:d.viewerCount));b("promiseDone")(d,function(d){__p&&__p();if(this.$7)return;d=d.vod_presence_cvc;if(d){var e=d.cvc||0,f=d.is_displayed,h=d.next_poll_ms||i;this.$9=d.video_asset_id;this.$1={viewerCount:e,showVODIndicator:f};a.emit("VideoVODCVC/viewCountChange",this.$1);h>=0&&c===g.POST_ENTER&&(this.$5=b("setTimeout")(this.$10.bind(this,a,c),h))}}.bind(this),function(d){if(this.$7)return;this.$5=b("setTimeout")(this.$10.bind(this,a,c),this.$6);this.$6=Math.min(Number.MAX_SAFE_INTEGER,2*this.$6)}.bind(this))};a.prototype.$13=function(a){return h+a};e.exports=a}),null);
__d("VideoPlayerFormatsID",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({UNKNOWN:0,INLINE:1,SNOWLIFT:2,PERMALINK:3,CHANNEL:4,FULL_SCREEN:5,SOCIAL_PLAYER:6,TV:7,MISC:8,WATCH_SCROLL:9,WATCH_SCROLL_APP_BACKGROUND:10,WATCH_AND_GO:11,WATCH_AND_BROWSE:12,CANVAS:13,TAHOE:14,FB_STORIES:15})}),null);
__d("VideoPlayerSourceID",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({UNKNOWN:0,TOP_LIVE_BOOKMARK:1,VIDEO_HOME:2,MEDIA_GALLERY:3,DIRECT_INBOX:4,FB_STORIES:5,BACKSTAGE:6,NOTIFICATIONS:7,LIVING_ROOM_RECAP:8,LIVING_ROOM:9,INSTANT_SHOPPING:10,GROUP:11,COMMERCE:12,NEWSFEED:13,PHOTOSFEED:14,PERMALINK:15,INSTANT_ARTICLES:16,PAGE_TIMELINE:17,EVENTS:18,EXPLORE_FEED:19,SEARCH:20,MOVIE_CHECKOUT_FLOW:21,LIVE_CHAINING:22,SAVED:23,USER_TIMELINE:24})}),null);
__d("VideoVODCVCSubscription",["EntityPresenceManager","EntityPresenceTypeEnum","Int64","Run","SubscriptionsHandler","VideoPlayerFormats","VideoPlayerFormatsID","VideoPlayerLoggerEvent","VideoPlayerOrigins","VideoPlayerSourceID","VideoSocialFabricCVCExperiments"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=42,h=7,i=5;function a(a){__p&&__p();this.$7=function(){this.$5=null,this.$4&&(this.$4&&this.$4.leave(),this.$4=null)}.bind(this);if(!b("VideoSocialFabricCVCExperiments").isCVCSubscriptionEnabled||a.isAd()||a.isLiveVideo())return;this.$1=new(b("SubscriptionsHandler"))();this.$4=null;this.$2=a;this.$3=this.$2.getPlayerOrigin();this.$5=null;this.$1.addSubscriptions(a.addListener("beginPlayback",function(){this.$5=null}.bind(this)),a.addListener("updateStatus",function(a){this.$2.isState("playing")&&(this.$5===null&&(this.$5=a.position),this.$5+3<=a.position&&(this.$2.logEvent(b("VideoPlayerLoggerEvent").PLAYED_FOR_THREE_SECONDS),this.$5=Infinity,this.$6()))}.bind(this)),a.addListener("pausePlayback",this.$7),a.addListener("finishPlayback",function(){return!a.getOption("Looping","isLooping")&&this.$7()}.bind(this)),a.addListener("becomeInvisible",this.$7),a.addListener("seekEnd",this.$7),a.addListener("TahoeController/exitTahoe",this.$7));b("Run").onLeave(function(){return this.cleanOnLeave()}.bind(this))}a.prototype.cleanOnLeave=function(){this.$7(),this.$1&&this.$1.release()};a.prototype.$6=function(){if(this.$4)return;this.$4=b("EntityPresenceManager").enter(b("EntityPresenceTypeEnum").VOD,this.$2.getVideoID(),this.getLoggingCapabilitiesForEntityPresence())};a.prototype.getLoggingCapabilitiesForEntityPresence=function(){__p&&__p();var a=b("Int64").fromInt(0);a=b("Int64").fromString(Date.now().toString());var c=7;a=a.shiftLeft(c);b("VideoSocialFabricCVCExperiments").isCVCPolledBySkywalker||(a=a.add(b("Int64").fromInt(1)));c=64-(g+h+i+c);a=a.shiftLeft(c);a=a.shiftLeft(i);a=a.add(b("Int64").fromInt(this.mapPlayerFormatToCapabilityBits(this.$2.getPlayerFormat())));a=a.shiftLeft(h);a=a.add(b("Int64").fromInt(this.mapPlayerOriginToCapabilityBits(this.$3)));return a};a.prototype.mapPlayerOriginToCapabilityBits=function(a){__p&&__p();if(a===null)return b("VideoPlayerSourceID").UNKNOWN;switch(a){case b("VideoPlayerOrigins").COMMERCE:return b("VideoPlayerSourceID").COMMERCE;case b("VideoPlayerOrigins").DIRECT_INBOX:return b("VideoPlayerSourceID").DIRECT_INBOX;case b("VideoPlayerOrigins").EVENTS:return b("VideoPlayerSourceID").EVENTS;case b("VideoPlayerOrigins").EXPLORE_FEED:return b("VideoPlayerSourceID").EXPLORE_FEED;case b("VideoPlayerOrigins").FB_STORIES:return b("VideoPlayerSourceID").FB_STORIES;case b("VideoPlayerOrigins").GROUP:return b("VideoPlayerSourceID").GROUP;case b("VideoPlayerOrigins").INSTANT_ARTICLES:return b("VideoPlayerSourceID").INSTANT_ARTICLES;case b("VideoPlayerOrigins").INSTANT_SHOPPING:return b("VideoPlayerSourceID").INSTANT_ARTICLES;case b("VideoPlayerOrigins").LIVE_CHAINING:return b("VideoPlayerSourceID").LIVE_CHAINING;case b("VideoPlayerOrigins").LIVING_ROOM:return b("VideoPlayerSourceID").LIVING_ROOM;case b("VideoPlayerOrigins").LIVING_ROOM_RECAP:return b("VideoPlayerSourceID").LIVING_ROOM_RECAP;case b("VideoPlayerOrigins").MEDIA_GALLERY:return b("VideoPlayerSourceID").MEDIA_GALLERY;case b("VideoPlayerOrigins").MOVIE_CHECKOUT_FLOW:return b("VideoPlayerSourceID").MOVIE_CHECKOUT_FLOW;case b("VideoPlayerOrigins").NEWSFEED:return b("VideoPlayerSourceID").NEWSFEED;case b("VideoPlayerOrigins").NOTIFICATIONS:return b("VideoPlayerSourceID").NOTIFICATIONS;case b("VideoPlayerOrigins").PAGE_TIMELINE:return b("VideoPlayerSourceID").PAGE_TIMELINE;case b("VideoPlayerOrigins").PERMALINK:return b("VideoPlayerSourceID").PERMALINK;case b("VideoPlayerOrigins").PHOTOSFEED:return b("VideoPlayerSourceID").PHOTOSFEED;case b("VideoPlayerOrigins").SAVED:return b("VideoPlayerSourceID").SAVED;case b("VideoPlayerOrigins").SEARCH:return b("VideoPlayerSourceID").SEARCH;case b("VideoPlayerOrigins").TOP_LIVE_BOOKMARK:return b("VideoPlayerSourceID").TOP_LIVE_BOOKMARK;case b("VideoPlayerOrigins").USER_TIMELINE:return b("VideoPlayerSourceID").USER_TIMELINE;case b("VideoPlayerOrigins").VIDEO_HOME:return b("VideoPlayerSourceID").VIDEO_HOME;case b("VideoPlayerOrigins").UNKNOWN:default:return b("VideoPlayerSourceID").UNKNOWN}};a.prototype.mapPlayerFormatToCapabilityBits=function(a){__p&&__p();if(a===null)return b("VideoPlayerFormatsID").UNKNOWN;switch(a){case b("VideoPlayerFormats").INLINE:return b("VideoPlayerFormatsID").INLINE;case b("VideoPlayerFormats").SNOWLIFT:return b("VideoPlayerFormatsID").SNOWLIFT;case b("VideoPlayerFormats").PERMALINK:return b("VideoPlayerFormatsID").PERMALINK;case b("VideoPlayerFormats").CHANNEL:return b("VideoPlayerFormatsID").CHANNEL;case b("VideoPlayerFormats").FULL_SCREEN:return b("VideoPlayerFormatsID").FULL_SCREEN;case b("VideoPlayerFormats").SOCIAL_PLAYER:return b("VideoPlayerFormatsID").SOCIAL_PLAYER;case b("VideoPlayerFormats").TV:return b("VideoPlayerFormatsID").TV;case b("VideoPlayerFormats").MISC:return b("VideoPlayerFormatsID").MISC;case b("VideoPlayerFormats").WATCH_SCROLL:return b("VideoPlayerFormatsID").WATCH_SCROLL;case b("VideoPlayerFormats").WATCH_SCROLL_APP_BACKGROUND:return b("VideoPlayerFormatsID").WATCH_SCROLL_APP_BACKGROUND;case b("VideoPlayerFormats").WATCH_AND_GO:return b("VideoPlayerFormatsID").WATCH_AND_GO;case b("VideoPlayerFormats").WATCH_AND_BROWSE:return b("VideoPlayerFormatsID").WATCH_AND_BROWSE;case b("VideoPlayerFormats").CANVAS:return b("VideoPlayerFormatsID").CANVAS;case b("VideoPlayerFormats").TAHOE:return b("VideoPlayerFormatsID").TAHOE;case b("VideoPlayerFormats").FB_STORIES:return b("VideoPlayerFormatsID").FB_STORIES;default:return b("VideoPlayerFormatsID").UNKNOWN}};e.exports=a}),null);
__d("VideoVODCVCUI.react",["ix","cx","Image.react","React","VideoSocialFabricCVCExperiments","asset","intlSummarizeNumber"],(function(a,b,c,d,e,f,g,h){"use strict";var i;i=babelHelpers.inherits(a,b("React").PureComponent);i&&i.prototype;a.prototype.render=function(){return b("React").createElement("div",{className:"_75tx"},b("React").createElement(b("Image.react"),{className:"_75ty"+(b("VideoSocialFabricCVCExperiments").isCVCUsingPeopleIcon?"":" _76of"),src:b("VideoSocialFabricCVCExperiments").isCVCUsingPeopleIcon?g("488783"):g("532616")}),b("intlSummarizeNumber")(this.props.viewerCount))};function a(){i.apply(this,arguments)}e.exports=a}),null);
__d("VideoVODIndicator.react",["cx","fbt","BasicFBNux","JSResource","React","SubscriptionsHandler","TooltipData","VideoSocialFabricCVCExperiments","VideoVODCVCUI.react","joinClasses","lazyLoadComponent"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=b("lazyLoadComponent")(b("JSResource")("XUIAmbientNUX.react").__setRef("VideoVODIndicator.react")),k=6171,l=!1;c=babelHelpers.inherits(a,b("React").Component);i=c&&c.prototype;function a(a){__p&&__p();i.constructor.call(this,a);this.$2=null;this.state={showVODIndicator:!1,isDisplayingAdBreak:!1,viewerCount:null,showNUX:b("VideoSocialFabricCVCExperiments").shouldShowNUX&&!l};this.$3=function(){b("BasicFBNux").onDismiss(k),this.setState({showNUX:!1})}.bind(this);a=this.props.vpc;if(this.props.renderLocation==="tahoeBackAffordance"){a=a.getOption("VideoVODCVCFetching","cvcData");a&&(this.state.showVODIndicator=a.showVODIndicator,this.state.viewerCount=a.viewerCount)}}a.prototype.initSubscriptions=function(a){this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(a.addListener("VideoVODCVC/viewCountChange",function(a){this.setState({showVODIndicator:a.showVODIndicator,viewerCount:a.viewerCount})}.bind(this)),a.addListener("finishPlayback",function(){return!a.getOption("Looping","isLooping")&&this.setState({showVODIndicator:!1})}.bind(this)),a.addListener("commercialBreak/vodBreakStarting",function(){this.setState({isDisplayingAdBreak:!0})}.bind(this)),a.addListener("commercialBreak/showUFI",function(){this.setState({isDisplayingAdBreak:!1})}.bind(this)))};a.prototype.releaseSubscriptions=function(){this.$2&&this.$2.release()};a.prototype.componentDidMount=function(){this.initSubscriptions(this.props.vpc)};a.prototype.componentWillUnmount=function(){this.releaseSubscriptions()};a.prototype.render=function(){if(!b("VideoSocialFabricCVCExperiments").isCVCDisplayEnabled||!this.state.showVODIndicator||!this.state.viewerCount||this.state.isDisplayingAdBreak)return null;var a=null,c=null;this.state.showNUX?(c=b("React").createElement(b("React").Suspense,{fallback:null},b("React").createElement(j,{contextRef:function(){return this.$1}.bind(this),position:"right",shown:!0,onCloseButtonClick:this.$3},h._("See how many people are watching this video right now"))),l||(l=!0,b("BasicFBNux").onView(k))):b("VideoSocialFabricCVCExperiments").shouldShowTooltip&&(a=b("TooltipData").propsFor(h._("Number of people watching now"),"right"));return b("React").createElement("div",babelHelpers["extends"]({className:b("joinClasses")("_75ug"+(this.props.renderLocation==="tahoeBackAffordance"?" _7348":"")+(this.props.renderLocation==="videoHomeFeedUnit"?" _72u5":"")+(this.props.renderLocation==="videoNewsFeedUnit"?" _75uh":"")+" uiContextualLayerParent")},a),b("React").createElement(b("VideoVODCVCUI.react"),{ref:function(a){return this.$1=a}.bind(this),viewerCount:this.state.viewerCount}),c)};e.exports=a}),null);