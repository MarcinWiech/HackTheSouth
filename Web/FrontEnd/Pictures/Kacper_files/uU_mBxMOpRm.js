if (self.CavalryLogger) { CavalryLogger.start_js(["FEkHt"]); }

__d("AudioEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({CREATE_STREAM:"AUDIO_CREATE_STREAM",FINISH:"AUDIO_FINISH",LOAD:"AUDIO_LOAD",MUTE:"AUDIO_MUTE",PAUSE:"AUDIO_PAUSE",PLAY:"AUDIO_PLAY",REPLAY:"AUDIO_REPLAY",SCRUB_BEGIN:"AUDIO_SCRUB_BEGIN",SCRUB_END:"AUDIO_SCRUB_END",SEEK:"AUDIO_SEEK",STREAM_CHANGE:"AUDIO_STREAM_CHANGE",UNMUTE:"AUDIO_UNMUTE",UPDATE_BUFFER:"AUDIO_UPDATE_BUFFER",UPDATE_DURATION:"AUDIO_UPDATE_DURATION",UPDATE_TIME:"AUDIO_UPDATE_TIME",VOLUME_CHANGE:"AUDIO_VOLUME_CHANGE",REPLACE_STREAM:"AUDIO_REPLACE_STREAM",FETCH_URL:"AUDIO_FETCH_URL",BLOCK_FETCH:"AUDIO_BLOCK_FETCH",ALLOW_FETCH:"AUDIO_ALLOW_FETCH",SOUNDCLOUD_CHECKPOINT:"AUDIO_SOUNDCLOUD_CHECKPOINT"})}),null);
__d("Audio",["AudioEvents","EventEmitter","Run","nullthrows"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("EventEmitter"));g=c&&c.prototype;function a(){"use strict";g.constructor.call(this),this.resetAudioStreams(),b("Run").onLeave(this.$Audio3.bind(this))}a.prototype.addStream=function(a,c){"use strict";this.$Audio1.has(a)||(this.$Audio1.set(a,[]),this.$Audio2.set(a,[]));var d=b("nullthrows")(this.$Audio1.get(a)).length;c=this.$Audio4(a,d,c.preload);b("nullthrows")(this.$Audio1.get(a)).push(c);b("nullthrows")(this.$Audio2.get(a)).push(!1);return d};a.prototype.play=function(a,c){"use strict";if(!this.$Audio1.has(a)||b("nullthrows")(this.$Audio2.get(a))[c])return;b("nullthrows")(this.$Audio1.get(a))[c].play();b("nullthrows")(this.$Audio2.get(a))[c]=!0};a.prototype.pause=function(a,c){"use strict";if(!this.$Audio1.has(a)||!b("nullthrows")(this.$Audio2.get(a))[c])return;b("nullthrows")(this.$Audio1.get(a))[c].pause();b("nullthrows")(this.$Audio2.get(a))[c]=!1};a.prototype.seek=function(a,c,d){"use strict";b("nullthrows")(this.$Audio1.get(a))[c].currentTime=d};a.prototype.setVolume=function(a,c,d){"use strict";b("nullthrows")(this.$Audio1.get(a))[c].volume=d};a.prototype.mute=function(a,c){"use strict";b("nullthrows")(this.$Audio1.get(a))[c].muted=!0};a.prototype.unmute=function(a,c){"use strict";b("nullthrows")(this.$Audio1.get(a))[c].muted=!1};a.prototype.getBufferedPosition=function(a,c){"use strict";a=b("nullthrows")(this.$Audio1.get(a))[c].buffered;c=a.length;return c?a.end(c-1):0};a.prototype.getDuration=function(a,c){"use strict";return b("nullthrows")(this.$Audio1.get(a))[c].duration};a.prototype.getAudioStream=function(a){"use strict";return this.$Audio1.get(a)};a.prototype.getIsPlaying=function(a){"use strict";return this.$Audio2.get(a)};a.prototype.resetAudioStreams=function(){"use strict";this.$Audio1=new Map(),this.$Audio2=new Map()};a.prototype.$Audio3=function(){"use strict";__p&&__p();b("Run").onAfterLoad(function(){b("Run").onLeave(this.$Audio3.bind(this))}.bind(this));for(var a=this.$Audio2,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;var f=e[0];e=e[1];for(var g=0,h;g<e.length;g++){h=e[g];if(h){h=b("nullthrows")(this.$Audio1.get(f))[g];h.pause();h.remove()}}}this.resetAudioStreams()};a.prototype.$Audio4=function(a,c,d){"use strict";__p&&__p();var e=document.createElement("audio");e.setAttribute("preload",d?"auto":"metadata");e.addEventListener("loadedmetadata",function(d){this.$Audio5(b("AudioEvents").UPDATE_DURATION,a,c,e.duration)}.bind(this));e.addEventListener("progress",function(d){d=e.buffered.length;this.$Audio5(b("AudioEvents").UPDATE_BUFFER,a,c,d?e.buffered.end(d-1):0)}.bind(this));e.addEventListener("timeupdate",function(d){this.$Audio5(b("AudioEvents").UPDATE_TIME,a,c,e.currentTime)}.bind(this));e.addEventListener("ended",function(d){this.$Audio5(b("AudioEvents").FINISH,a,c)}.bind(this));e.src=a;return e};a.prototype.$Audio5=function(a,b,c,d){"use strict";b={uri:b,index:c,value:d};this.emit(a,b)};e.exports=new a()}),null);
__d("MusicStoryTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$1={}}a.prototype.log=function(){b("GeneratedLoggerUtils").log("music_story_logger:MusicStoryLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("music_story_logger:MusicStoryLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("music_story_logger:MusicStoryLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAlbumTitle=function(a){this.$1.album_title=a;return this};a.prototype.setArtistName=function(a){this.$1.artist_name=a;return this};a.prototype.setAudioDurationMs=function(a){this.$1.audio_duration_ms=a;return this};a.prototype.setAudioTitle=function(a){this.$1.audio_title=a;return this};a.prototype.setClientUserID=function(a){this.$1.client_userid=a;return this};a.prototype.setContainermodule=function(a){this.$1.containermodule=a;return this};a.prototype.setContentID=function(a){this.$1.content_id=a;return this};a.prototype.setCtaAction=function(a){this.$1.cta_action=a;return this};a.prototype.setError=function(a){this.$1.error=a;return this};a.prototype.setEvent=function(a){this.$1.event=a;return this};a.prototype.setHasMinutiae=function(a){this.$1.has_minutiae=a;return this};a.prototype.setMinutiaeID=function(a){this.$1.minutiae_id=a;return this};a.prototype.setMusicID=function(a){this.$1.music_id=a;return this};a.prototype.setPlatformName=function(a){this.$1.platform_name=a;return this};a.prototype.setPlayDurationMs=function(a){this.$1.play_duration_ms=a;return this};a.prototype.setPlaylistName=function(a){this.$1.playlist_name=a;return this};a.prototype.setStallDurationMs=function(a){this.$1.stall_duration_ms=a;return this};a.prototype.setStartDelayMs=function(a){this.$1.start_delay_ms=a;return this};a.prototype.setStoryType=function(a){this.$1.story_type=a;return this};a.prototype.setTime=function(a){this.$1.time=a;return this};a.prototype.setUnplayedBufferTimeMs=function(a){this.$1.unplayed_buffer_time_ms=a;return this};a.prototype.setWeight=function(a){this.$1.weight=a;return this};c={album_title:!0,artist_name:!0,audio_duration_ms:!0,audio_title:!0,client_userid:!0,containermodule:!0,content_id:!0,cta_action:!0,error:!0,event:!0,has_minutiae:!0,minutiae_id:!0,music_id:!0,platform_name:!0,play_duration_ms:!0,playlist_name:!0,stall_duration_ms:!0,start_delay_ms:!0,story_type:!0,time:!0,unplayed_buffer_time_ms:!0,weight:!0};e.exports=a}),null);
__d("MusicStoryDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f){var g;c=babelHelpers.inherits(a,b("ExplicitRegistrationDispatcher"));g=c&&c.prototype;function a(a){"use strict";g.constructor.call(this,a),this.dispatch=this.dispatch.bind(this)}e.exports=new a({strict:!0})}),null);
__d("MusicStoryAudioActions",["AudioEvents","MusicStoryDispatcher"],(function(a,b,c,d,e,f){__p&&__p();a={createStream:function(a,c,d,e,f){a={type:b("AudioEvents").CREATE_STREAM,titleUriList:a,uniqueId:d,extraData:e,isDynamicUri:f};c&&(a.loggingData=c);b("MusicStoryDispatcher").dispatch(a)},play:function(a){a={type:b("AudioEvents").PLAY,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},pause:function(a){a={type:b("AudioEvents").PAUSE,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},scrubBegin:function(a){a={type:b("AudioEvents").SCRUB_BEGIN,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},scrubEnd:function(a,c){a={type:b("AudioEvents").SCRUB_END,uniqueId:a,value:c};b("MusicStoryDispatcher").dispatch(a)},mute:function(a){a={type:b("AudioEvents").MUTE,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},unmute:function(a){a={type:b("AudioEvents").UNMUTE,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},setVolume:function(a,c){a={type:b("AudioEvents").VOLUME_CHANGE,uniqueId:a,value:c};b("MusicStoryDispatcher").dispatch(a)},updatePlaybackPos:function(a,c){a={type:b("AudioEvents").UPDATE_TIME,uniqueId:a,value:c};b("MusicStoryDispatcher").isDispatching()||b("MusicStoryDispatcher").dispatch(a)},updateDuration:function(a,c,d,e){a={type:b("AudioEvents").UPDATE_DURATION,uniqueId:a,value:c,uri:d,copyNumber:e};b("MusicStoryDispatcher").dispatch(a)},updateBufferedPos:function(a,c){a={type:b("AudioEvents").UPDATE_BUFFER,uniqueId:a,value:c};b("MusicStoryDispatcher").isDispatching()||b("MusicStoryDispatcher").dispatch(a)},updateIsFinished:function(a){a={type:b("AudioEvents").FINISH,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},changeStream:function(a,c,d){a={type:b("AudioEvents").STREAM_CHANGE,uniqueId:a,value:c,previousTitle:d};b("MusicStoryDispatcher").dispatch(a)},deleteStream:function(a){a={type:b("AudioEvents").DELETE_STREAM,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},replaceStream:function(a,c){c={type:b("AudioEvents").REPLACE_STREAM,stream:c,uniqueId:a};b("MusicStoryDispatcher").dispatch(c)},fetchURL:function(a,c,d){d===void 0&&(d=-1);a={type:b("AudioEvents").FETCH_URL,uniqueId:a,subsequentAction:c,value:d};b("MusicStoryDispatcher").dispatch(a)},blockFetches:function(a){a={type:b("AudioEvents").BLOCK_FETCH,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)},allowFetches:function(a){a={type:b("AudioEvents").ALLOW_FETCH,uniqueId:a};b("MusicStoryDispatcher").dispatch(a)}};e.exports=a}),null);
__d("AudioMetaData",["immutable"],(function(a,b,c,d,e,f){var g;g=babelHelpers.inherits(a,b("immutable").Record({title:"",uri:"",duration:0,copyNumber:-1,dynamicUri:"",playbackPosition:-1,soundcloudBeacons:null}));g&&g.prototype;function a(){"use strict";g.apply(this,arguments)}e.exports=a}),null);
__d("AudioStream",["Arbiter","Audio","AudioEvents","AudioMetaData","MusicStoryAudioActions","SubscriptionsHandler","curry","immutable"],(function(a,b,c,d,e,f){__p&&__p();var g,h=1e3;a={bufferedPosition:0,duration:0,isDynamicUri:!1,isFinished:!1,isMuted:!1,isPlaying:!1,isScrubbing:!1,playbackPosition:0,audioMetaDataList:b("immutable").List(),activeTrack:0,volume:1,subscriptions:new(b("SubscriptionsHandler"))(),storyIdentifier:null,blockFetches:!1};var i=[b("AudioEvents").UPDATE_TIME,b("AudioEvents").UPDATE_DURATION,b("AudioEvents").UPDATE_BUFFER,b("AudioEvents").FINISH];g=babelHelpers.inherits(j,b("immutable").Record(a));g&&g.prototype;j.createStream=function(a,c,d,e){"use strict";var f=new j(),g=b("immutable").List(),h=d.storyIdentifier;d=d.isPermalink;h&&f.subscriptions.addSubscriptions(b("Arbiter").subscribe("Story/delete",b("curry")(j.$AudioStream1,c,h)));for(var i=0,k;i<a.length;i++)k=a[i],k=j.createMetaData(k),e||(k=j.createAudio(k,c,i,d,e)),g=g.push(k);return f.set("audioMetaDataList",g).set("isDynamicUri",e).set("storyIdentifier",h)};j.createMetaData=function(a){"use strict";return new(b("AudioMetaData"))({title:a.title,uri:a.uri})};j.createAudio=function(a,c,d,e,f){"use strict";__p&&__p();f=a.get(f?"dynamicUri":"uri");e=b("Audio").addStream(f,{preload:e&&d===0});a=a.set("copyNumber",e);for(var d=0;d<i.length;d++){var g=i[d];b("Audio").addListener(g,j.updatePropertyCallback(c,f,a.get("copyNumber"),g))}a.get("playbackPosition")>0&&b("Audio").seek(f,e,a.get("playbackPosition"));return a};j.updatePropertyCallback=function(a,c,d,e){"use strict";__p&&__p();var f;switch(e){case b("AudioEvents").UPDATE_TIME:f=b("MusicStoryAudioActions").updatePlaybackPos;break;case b("AudioEvents").UPDATE_DURATION:f=b("MusicStoryAudioActions").updateDuration;break;case b("AudioEvents").UPDATE_BUFFER:f=b("MusicStoryAudioActions").updateBufferedPos;break;case b("AudioEvents").FINISH:f=b("MusicStoryAudioActions").updateIsFinished;break}return function(b){b.uri===c&&b.index===d&&f(a,b.value,b.uri,b.index)}};j.prototype.play=function(){"use strict";var a=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").play(a,this.getActiveCopyNo())};j.prototype.pause=function(){"use strict";var a=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").pause(a,this.getActiveCopyNo())};j.prototype.mute=function(){"use strict";var a=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").mute(a,this.getActiveCopyNo())};j.prototype.unmute=function(){"use strict";var a=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").unmute(a,this.getActiveCopyNo())};j.prototype.seek=function(a){"use strict";var c=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").seek(c,this.getActiveCopyNo(),a)};j.prototype.changeVolume=function(a){"use strict";var c=this.get("isDynamicUri")?this.getActiveDynamicUri():this.getActiveUri();b("Audio").setVolume(c,this.getActiveCopyNo(),a)};j.prototype.getActiveTrackTitle=function(){"use strict";var a=this.get("audioMetaDataList"),b=this.get("activeTrack");return a.get(b).title};j.prototype.getActiveTrackDurationMs=function(){"use strict";var a=this.get("audioMetaDataList"),b=this.get("activeTrack");a=a.get(b).duration;return Math.floor(a*h)};j.prototype.getActiveUri=function(){"use strict";var a=this.get("audioMetaDataList").get(this.get("activeTrack"));return a.get("uri")};j.prototype.getActiveDynamicUri=function(){"use strict";var a=this.get("audioMetaDataList").get(this.get("activeTrack"));return a.get("dynamicUri")};j.prototype.getActiveCopyNo=function(){"use strict";var a=this.get("audioMetaDataList").get(this.get("activeTrack"));return a.get("copyNumber")};j.prototype.getBufferedPosition=function(){"use strict";return b("Audio").getBufferedPosition(this.getActiveUri(),this.getActiveCopyNo())};j.prototype.getActiveMetaData=function(){"use strict";return this.get("audioMetaDataList").get(this.get("activeTrack"))};j.$AudioStream1=function(a,c,d,e){"use strict";if(c!==e)return;b("MusicStoryAudioActions").deleteStream(a)};function j(){"use strict";g.apply(this,arguments)}e.exports=j}),null);
__d("XSoundCloudAudioURLController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/music/soundcloud/exchange_url/",{})}),null);
__d("MusicStoryAudioStore",["AsyncRequest","AudioEvents","AudioStream","FluxReduceStore","MusicStoryAudioActions","MusicStoryDispatcher","XSoundCloudAudioURLController","immutable"],(function(a,b,c,d,e,f){__p&&__p();var g,h;c={streams:b("immutable").Map()};g=babelHelpers.inherits(i,b("immutable").Record(c));g&&g.prototype;i.prototype.getStream=function(a){"use strict";return this.get("streams").get(a)};i.prototype.setStream=function(a,b){"use strict";return this.get("streams").set(a,b)};function i(){"use strict";g.apply(this,arguments)}h=babelHelpers.inherits(a,b("FluxReduceStore"));h&&h.prototype;a.prototype.getInitialState=function(){"use strict";return new i()};a.prototype.getStream=function(a){"use strict";return this.getState().getStream(a)};a.prototype.getBeacons=function(a){"use strict";return this.getStream(a).getActiveMetaData().get("soundcloudBeacons")};a.prototype.getActiveTrackTitle=function(a){"use strict";a=this.getState().getStream(a);return a.getActiveTrackTitle()};a.prototype.getActiveTrackDurationMs=function(a){"use strict";a=this.getState().getStream(a);return a.getActiveTrackDurationMs()};a.prototype.getIsPlaying=function(a){"use strict";return this.getState().getStream(a).get("isPlaying")};a.prototype.getIsDynamicURL=function(a){"use strict";return this.getState().getStream(a).get("isDynamicUri")};a.prototype.reduce=function(a,c){"use strict";__p&&__p();var d,e=c.uniqueId;switch(c.type){case b("AudioEvents").CREATE_STREAM:d=b("AudioStream").createStream(c.titleUriList,e,c.extraData,c.isDynamicUri);a=a.set("streams",a.setStream(e,d));return a;case b("AudioEvents").REPLACE_STREAM:a=a.set("streams",a.setStream(e,c.stream));return a;case b("AudioEvents").BLOCK_FETCH:d=a.getStream(e);d=d.set("blockFetches",!0);a=this.doBooleanAction(a,e,b("AudioEvents").PAUSE);a=a.set("streams",a.setStream(e,d));return a;case b("AudioEvents").ALLOW_FETCH:d=a.getStream(e);d=d.set("blockFetches",!1);a=a.set("streams",a.setStream(e,d));return a;case b("AudioEvents").FETCH_URL:this.fetchDynamicUri(a.getStream(e),e,c.subsequentAction,c.value);return a;case b("AudioEvents").PLAY:case b("AudioEvents").PAUSE:case b("AudioEvents").MUTE:case b("AudioEvents").UNMUTE:return this.doBooleanAction(a,e,c.type);case b("AudioEvents").VOLUME_CHANGE:return this.doNumericAction(a,e,c.type,c.value);case b("AudioEvents").SCRUB_BEGIN:a.getStream(e).get("isPlaying")&&(a=this.doBooleanAction(a,e,c.type));a=this.setProperty(a,e,"isScrubbing",!0);return a;case b("AudioEvents").SCRUB_END:a.getStream(e).get("isPlaying")&&(a=this.doBooleanAction(a,e,c.type));a.getStream(e).get("isFinished")&&(a=this.doBooleanAction(a,e,b("AudioEvents").PLAY));a=this.doNumericAction(a,e,c.type,c.value);a=this.setProperty(a,e,"isScrubbing",!1);return a;case b("AudioEvents").UPDATE_TIME:a=this.setProperty(a,e,"playbackPosition",c.value);return this.setMetaDataProperty(a,e,"playbackPosition",c.value);case b("AudioEvents").UPDATE_DURATION:return this.setDuration(a,e,c.uri,c.copyNumber,c.value);case b("AudioEvents").UPDATE_BUFFER:return this.setProperty(a,e,"bufferedPosition",c.value);case b("AudioEvents").FINISH:return this.setIsFinished(a,e,!0);case b("AudioEvents").STREAM_CHANGE:return this.changeActiveStream(a,e,c.value);default:return a}};a.prototype.deleteStream=function(a,c){"use strict";return this.doBooleanAction(a,c,b("AudioEvents").PAUSE)};a.prototype.changeActiveStream=function(a,c,d){"use strict";__p&&__p();var e=a.getStream(c),f=e.get("isMuted");e=e.get("volume");a=this.doBooleanAction(a,c,b("AudioEvents").PAUSE);a=this.doNumericAction(a,c,b("AudioEvents").SCRUB_END,0);a=this.setProperty(a,c,"activeTrack",d);var g=this.getBufferedPosition(a,c);a=this.setProperty(a,c,"bufferedPosition",g);a=this.setProperty(a,c,"duration",this.getTrackDuration(a,c,d));a=f?this.doBooleanAction(a,c,b("AudioEvents").MUTE):this.doBooleanAction(a,c,b("AudioEvents").UNMUTE);a=this.doNumericAction(a,c,b("AudioEvents").VOLUME_CHANGE,e);a=this.doBooleanAction(a,c,b("AudioEvents").PLAY);return a};a.prototype.getBufferedPosition=function(a,b){"use strict";a=a.getStream(b);return a.getBufferedPosition()};a.prototype.getTrackDuration=function(a,b,c){"use strict";a=a.getStream(b);b=a.get("audioMetaDataList");return b.get(c).duration};a.prototype.setDuration=function(a,b,c,d,e){"use strict";__p&&__p();var f=0,g=!1,h=a.getStream(b),i=h.get("audioMetaDataList");i=i.map(function(a){var b=h.get("isDynamicUri")?a.get("dynamicUri"):a.get("uri");b===c&&a.copyNumber===d&&(a=a.set("duration",e),f===h.get("activeTrack")&&(g=!0));f++;return a});h=h.set("audioMetaDataList",i);a=a.set("streams",a.setStream(b,h));g&&(a=this.setProperty(a,b,"duration",e));return a};a.prototype.setIsFinished=function(a,c,d){"use strict";a=this.doBooleanAction(a,c,b("AudioEvents").PAUSE);a=this.setMetaDataProperty(a,c,"playbackPosition",-1);return this.setProperty(a,c,"isFinished",d)};a.prototype.doBooleanAction=function(a,c,d){"use strict";__p&&__p();var e=[],f=[],g=a.getStream(c);f.push(d===b("AudioEvents").PLAY||d===b("AudioEvents").MUTE||d===b("AudioEvents").SCRUB_BEGIN);if(d===b("AudioEvents").PLAY||d===b("AudioEvents").PAUSE){e.push("isPlaying");var h=a.getStream(c).get("isFinished");d===b("AudioEvents").PLAY&&h&&(e.push("isFinished"),f.push(!1))}else(d===b("AudioEvents").MUTE||d===b("AudioEvents").UNMUTE)&&e.push("isMuted");switch(d){case b("AudioEvents").PLAY:case b("AudioEvents").SCRUB_END:g.play();break;case b("AudioEvents").PAUSE:case b("AudioEvents").SCRUB_BEGIN:g.pause();break;case b("AudioEvents").MUTE:g.mute();break;case b("AudioEvents").UNMUTE:g.unmute();break;default:throw new Error("Unsupported boolean action: "+d)}for(var h=0;h<e.length;h++)a=this.setProperty(a,c,e[h],f[h]);return a};a.prototype.fetchDynamicUri=function(a,c,d,e){"use strict";__p&&__p();new(b("AsyncRequest"))().setURI(b("XSoundCloudAudioURLController").getURIBuilder().getURI()).setMethod("POST").setData({endpoint_url:a.getActiveUri()}).setHandler(function(f){__p&&__p();var g=f.payload.media;f=f.payload.beacons;var h=a.getActiveMetaData(),i=document.createElement("audio");i=i.canPlayType("application/vnd.apple.mpegURL")!=="";i=i?g.hls:g.http;h=h.set("dynamicUri",i);h=h.set("soundcloudBeacons",f);h=b("AudioStream").createAudio(h,c,-1,!1,!0);g=a.get("audioMetaDataList").set(a.get("activeTrack"),h);a=a.set("audioMetaDataList",g);b("MusicStoryAudioActions").replaceStream(c,a);switch(d){case b("AudioEvents").PLAY:b("MusicStoryAudioActions").play(c,f.play);break;case b("AudioEvents").SCRUB_END:b("MusicStoryAudioActions").scrubEnd(c,e);break;default:break}b("MusicStoryAudioActions").allowFetches(c)}).setErrorHandler(function(a){}).send()};a.prototype.doNumericAction=function(a,c,d,e){"use strict";var f,g=a.getStream(c);if(d===b("AudioEvents").SCRUB_END)g.seek(e),f="playbackPosition";else if(d===b("AudioEvents").VOLUME_CHANGE)g.changeVolume(e),f="volume";else throw new Error("Unsupported integer action: "+d);return this.setProperty(a,c,f,e)};a.prototype.setProperty=function(a,b,c,d){"use strict";var e=a.getStream(b);e=e.set(c,d);return a.set("streams",a.setStream(b,e))};a.prototype.setMetaDataProperty=function(a,b,c,d){"use strict";var e=a.getStream(b),f=e.get("activeTrack"),g=e.get("audioMetaDataList"),h=g.get(f);h=h.set(c,d);g=g.set(f,h);e=e.set("audioMetaDataList",g);return a.set("streams",a.setStream(b,e))};function a(){"use strict";h.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("MusicStoryDispatcher"))}),null);
__d("MusicStoryBanzaiFeedLogger",["Banzai"],(function(a,b,c,d,e,f){a={logOutboundClick:function(a){a&&b("Banzai").post("music_story_outbound_click",a)}};e.exports=a}),null);
__d("MusicStoryLoggerEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({CTA_CLICK:"music_cta_click",ERROR:"music_error",OPEN:"music_open",PAUSE:"music_pause",PLAY:"music_play",PLAY_REQUESTED:"music_play_requested",REACHED_END:"music_reached_end",STALL:"music_stall",SOUNDCLOUD_CHECKPOINT:"music_soundcloud_checkpoint"})}),null);
__d("MusicStoryEventLogger",["MusicStoryLoggerEvents","MusicStoryTypedLogger"],(function(a,b,c,d,e,f){__p&&__p();var g;a=babelHelpers.inherits(h,b("MusicStoryTypedLogger"));g=a&&a.prototype;h.isValidRequiredData=function(a){"use strict";return Object.prototype.hasOwnProperty.call(a,"artist_name")&&Object.prototype.hasOwnProperty.call(a,"content_id")&&Object.prototype.hasOwnProperty.call(a,"has_minutiae")&&Object.prototype.hasOwnProperty.call(a,"minutiae_id")&&Object.prototype.hasOwnProperty.call(a,"music_id")&&Object.prototype.hasOwnProperty.call(a,"platform_name")&&Object.prototype.hasOwnProperty.call(a,"story_type")};function h(a){"use strict";if(!h.isValidRequiredData(a))throw new Error("Cannot create MusicStoryEventLogger, RequiredData: "+JSON.stringify(a)+" is missing required fields ");g.constructor.call(this);this.$MusicStoryEventLogger1=a;this.$MusicStoryEventLogger2=-1}h.prototype.logRequiredData=function(){"use strict";this.updateData(this.$MusicStoryEventLogger1);return this};h.prototype.logAdditionalData=function(a){"use strict";this.updateData(a);return this};h.prototype.logEvent=function(a,c){__p&&__p();c===void 0&&(c={});var d=[];switch(a){case b("MusicStoryLoggerEvents").CTA_CLICK:d.push("cta_action");break;case b("MusicStoryLoggerEvents").ERROR:d.push("error");break;case b("MusicStoryLoggerEvents").PLAY:d.push("audio_duration_ms");this.startPlaytimeTracker();break;case b("MusicStoryLoggerEvents").PAUSE:case b("MusicStoryLoggerEvents").REACHED_END:d.push("play_duration_ms");if(this.$MusicStoryEventLogger2<0)return;c.play_duration_ms=this.stopPlaytimeTracker();break;case b("MusicStoryLoggerEvents").STALL:break;default:break}for(var e=0;e<d.length;e++){var f=d[e];if(!Object.prototype.hasOwnProperty.call(c,f))throw new Error("The field: "+f+" must be logged with "+a)}this.logRequiredData().logAdditionalData(c).setEvent(a).log();this.clear()};h.prototype.startPlaytimeTracker=function(){"use strict";this.$MusicStoryEventLogger2=Date.now()};h.prototype.stopPlaytimeTracker=function(){"use strict";if(this.$MusicStoryEventLogger2<0)throw new Error("Cannot log event without a play event logged first");var a=Date.now()-this.$MusicStoryEventLogger2;this.$MusicStoryEventLogger2=-1;return a};e.exports=h}),null);
__d("MusicStoryLoggingStore",["AudioEvents","FluxReduceStore","MusicStoryAudioStore","MusicStoryDispatcher","MusicStoryEventLogger","MusicStoryLoggerEvents","immutable"],(function(a,b,c,d,e,f){__p&&__p();var g,h,i,j=1e3;c={loggerIndex:b("immutable").Map(),soundcloudCheckpointIndex:b("immutable").Map()};g=babelHelpers.inherits(k,b("immutable").Record(c));g&&g.prototype;k.prototype.getLogger=function(a){"use strict";return this.get("loggerIndex").get(a)};k.prototype.getCheckpointTracker=function(a){"use strict";return this.get("soundcloudCheckpointIndex").get(a)};function k(){"use strict";g.apply(this,arguments)}h=babelHelpers.inherits(l,b("immutable").Record({lastUpdateTimeStamp:-1,timePlayedSinceLastCheckpoint:0}));h&&h.prototype;function l(){"use strict";h.apply(this,arguments)}i=babelHelpers.inherits(a,b("FluxReduceStore"));i&&i.prototype;a.prototype.getInitialState=function(){"use strict";return new k()};a.prototype.reduce=function(a,c){"use strict";__p&&__p();var d=c.uniqueId,e=a.getLogger(d);if(e===null)return a;var f=b("MusicStoryAudioStore").getActiveTrackDurationMs(d),g=b("MusicStoryAudioStore").getActiveTrackTitle(d),h=b("MusicStoryAudioStore").getIsPlaying(d),i=b("MusicStoryAudioStore").getBeacons(d),k=b("MusicStoryAudioStore").getIsDynamicURL(d);switch(c.type){case b("AudioEvents").CREATE_STREAM:var l=c.loggingData;l!=null?a=this.addLogger(a,d,l):a=this.addNullLogger(a,d);a=this.addCheckpointTracker(a,d);break;case b("AudioEvents").PAUSE:k&&(e.logEvent(b("MusicStoryLoggerEvents").PAUSE,{audio_duration_ms:f,audio_title:g,beacon_url:i.pause,clienttime:Date.now()}),a=this.pauseCheckpointTracker(a,d));e.logEvent(b("MusicStoryLoggerEvents").PAUSE,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").PLAY:k?(e.logEvent(b("MusicStoryLoggerEvents").PLAY,{audio_duration_ms:f,audio_title:g,beacon_url:i.play,clienttime:Date.now()}),a=this.startCheckpointTracker(a,d)):e.logEvent(b("MusicStoryLoggerEvents").PLAY,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").SCRUB_BEGIN:h&&e.logEvent(b("MusicStoryLoggerEvents").PAUSE,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").SCRUB_END:h&&e.logEvent(b("MusicStoryLoggerEvents").PLAY,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").FINISH:k&&(a=this.pauseCheckpointTracker(a,d),e.logEvent(b("MusicStoryLoggerEvents").PAUSE,{audio_duration_ms:f,audio_title:g,beacon_url:i.stop,clienttime:Date.now()}));e.logEvent(b("MusicStoryLoggerEvents").REACHED_END,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").STREAM_CHANGE:h&&e.logEvent(b("MusicStoryLoggerEvents").PAUSE,{audio_duration_ms:f,audio_title:c.previousTitle});e.logEvent(b("MusicStoryLoggerEvents").PLAY,{audio_duration_ms:f,audio_title:g});break;case b("AudioEvents").UPDATE_TIME:if(k){l=Date.now();h=a.getCheckpointTracker(d);c=h;f=c.lastUpdateTimeStamp;g=c.timePlayedSinceLastCheckpoint;if(f>0){g+=l-f;if(g>29.5*j){k=i.checkpoint;e.logEvent("music_soundcloud_checkpoint",{beacon_url:k,clienttime:Date.now()});g=0}f=l;h=h.set("lastUpdateTimeStamp",f);h=h.set("timePlayedSinceLastCheckpoint",g);c=a.get("soundcloudCheckpointIndex");c=c.set(d,h);a=a.set("soundcloudCheckpointIndex",c)}}break;case b("AudioEvents").MUTE:case b("AudioEvents").UNMUTE:case b("AudioEvents").VOLUME_CHANGE:case b("AudioEvents").UPDATE_DURATION:case b("AudioEvents").UPDATE_BUFFER:break}return a};a.prototype.addLogger=function(a,c,d){"use strict";var e=a.get("loggerIndex");e=e.set(c,new(b("MusicStoryEventLogger"))(d));return a.set("loggerIndex",e)};a.prototype.addCheckpointTracker=function(a,b){"use strict";var c=a.get("soundcloudCheckpointIndex");c=c.set(b,new l());return a.set("soundcloudCheckpointIndex",c)};a.prototype.addNullLogger=function(a,b){"use strict";var c=a.get("loggerIndex");c=c.set(b,null);return a.set("loggerIndex",c)};a.prototype.pauseCheckpointTracker=function(a,b){"use strict";var c=a.getCheckpointTracker(b);c=c.set("lastUpdateTimeStamp",-1);var d=a.get("soundcloudCheckpointIndex");d=d.set(b,c);return a.set("soundcloudCheckpointIndex",d)};a.prototype.startCheckpointTracker=function(a,b){"use strict";var c=a.getCheckpointTracker(b);c=c.set("lastUpdateTimeStamp",Date.now());var d=a.get("soundcloudCheckpointIndex");d=d.set(b,c);return a.set("soundcloudCheckpointIndex",d)};function a(){"use strict";i.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("MusicStoryDispatcher"))}),null);
__d("MusicStoryBaseContainer.react",["AudioEvents","MusicStoryAudioActions","MusicStoryAudioStore","MusicStoryBanzaiFeedLogger","MusicStoryDispatcher","MusicStoryLoggingStore","React"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("React").PureComponent);g=c&&c.prototype;a.getStores=function(){"use strict";return[b("MusicStoryAudioStore"),b("MusicStoryLoggingStore")]};function a(a){"use strict";g.constructor.call(this,a);b("MusicStoryDispatcher").explicitlyRegisterStores([b("MusicStoryAudioStore"),b("MusicStoryLoggingStore")]);var c=a.loggingData,d=a.uniqueId,e=a.titleUriList;a=a.extraData;var f=a.isDynamicUri;b("MusicStoryAudioActions").createStream(e,c,d,a,f);f&&(b("MusicStoryAudioActions").blockFetches(this.props.uniqueId),b("MusicStoryAudioActions").fetchURL(this.props.uniqueId,b("AudioEvents").CREATE_STREAM))}a.prototype.play=function(){"use strict";b("MusicStoryBanzaiFeedLogger").logOutboundClick(this.props.ftKey),this.state.isDynamicUri?this.state.blockFetches||(b("MusicStoryAudioActions").blockFetches(this.props.uniqueId),b("MusicStoryAudioActions").fetchURL(this.props.uniqueId,b("AudioEvents").PLAY)):b("MusicStoryAudioActions").play(this.props.uniqueId)};a.prototype.pause=function(){"use strict";if(this.state.isDynamicUri){var a=b("MusicStoryAudioStore").getBeacons(this.props.uniqueId);b("MusicStoryAudioActions").pause(this.props.uniqueId,a.pause)}else b("MusicStoryAudioActions").pause(this.props.uniqueId)};a.prototype.scrubBegin=function(){"use strict";b("MusicStoryAudioActions").scrubBegin(this.props.uniqueId)};a.prototype.scrubEnd=function(a){"use strict";this.state.isDynamicUri?this.state.blockFetches||(b("MusicStoryAudioActions").blockFetches(this.props.uniqueId),b("MusicStoryAudioActions").fetchURL(this.props.uniqueId,b("AudioEvents").SCRUB_END,a)):b("MusicStoryAudioActions").scrubEnd(this.props.uniqueId,a)};a.prototype.mute=function(){"use strict";b("MusicStoryAudioActions").mute(this.props.uniqueId)};a.prototype.unmute=function(){"use strict";b("MusicStoryAudioActions").unmute(this.props.uniqueId)};a.prototype.toggleMuted=function(){"use strict";this.state.isMuted?this.unmute():this.mute()};a.prototype.changeVolume=function(a){"use strict";b("MusicStoryAudioActions").setVolume(this.props.uniqueId,a)};e.exports=a}),null);
__d("MusicStoryCollectionListItem.react",["ix","cx","Image.react","React","ShimButton.react","XUIText.react","fbglyph"],(function(a,b,c,d,e,f,g,h){a=function(a){var c=a.isPlaying,d=a.isActive,e=a.index,f=a.title,h=a.onTrackClick;c?c=b("React").createElement(b("Image.react"),{className:"_3-_y _3-4s",src:g("141376")}):c=b("React").createElement(b("XUIText.react"),{className:"_3-4s",size:"meta1",weight:"normal"},e+1+".");return b("React").createElement(b("ShimButton.react"),{className:"_3-4r"+(d?" _59j3":""),onClick:function(){return h(a.index)}},c,b("React").createElement(b("XUIText.react"),{className:"_3-4p",size:"meta1",weight:"normal"},f))};e.exports=a}),null);
__d("MusicStoryCollectionTrackList.react",["cx","MusicStoryCollectionListItem.react","React","ScrollableArea.react"],(function(a,b,c,d,e,f,g){a=function(a){var c=a.titleUriList.map(function(c,d){return b("React").createElement(b("MusicStoryCollectionListItem.react"),{key:d,index:d,title:c.title,uri:c.uri,isPlaying:a.isPlaying&&d===a.activeTrack,isActive:d===a.activeTrack,onTrackClick:a.onTrackClick})});return b("React").createElement(b("ScrollableArea.react"),{className:"_3cf2"},c)};e.exports=a}),null);
__d("MusicStoryTrackListContainer.react",["FluxContainer","MusicStoryAudioActions","MusicStoryAudioStore","MusicStoryBanzaiFeedLogger","MusicStoryBaseContainer.react","MusicStoryCollectionTrackList.react","React"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("MusicStoryBaseContainer.react"));g=c&&c.prototype;function a(a){"use strict";g.constructor.call(this,a),this.$MusicStoryTrackListContainer1=this.onTrackClick.bind(this)}a.prototype.onTrackClick=function(a){"use strict";if(this.state.activeTrack===a)this.state.isPlaying?this.pause():this.play();else{var c=this.props.uniqueId,d=b("MusicStoryAudioStore").getActiveTrackTitle(c);b("MusicStoryBanzaiFeedLogger").logOutboundClick(this.props.ftKey);b("MusicStoryAudioActions").changeStream(c,a,d)}};a.calculateState=function(a,c){"use strict";a=c.uniqueId;c=b("MusicStoryAudioStore").getStream(a);a=c.activeTrack;var d=c.bufferedPosition,e=c.isMuted,f=c.isPlaying,g=c.playbackPosition,h=c.volume,i=c.isFinished;c=c.duration;a={activeTrack:a,bufferedPosition:d,finishedPlaying:i,isMuted:e,isPlaying:f,playbackDuration:c,playbackPosition:g,volume:h,blockFetches:!1,isDynamicUri:!1};return a};a.prototype.componentDidUpdate=function(a,c){"use strict";__p&&__p();if(!c.finishedPlaying&&this.state.finishedPlaying){var d=this.state.activeTrack+1;if(d>=this.props.titleUriList.length)return;setTimeout(function(){if(this.state.activeTrack!==d-1)return;b("MusicStoryAudioActions").changeStream(this.props.uniqueId,d,b("MusicStoryAudioStore").getActiveTrackTitle(this.props.uniqueId))}.bind(this),1500)}};a.prototype.render=function(){"use strict";return b("React").createElement(b("MusicStoryCollectionTrackList.react"),{activeTrack:this.state.activeTrack,isPlaying:this.state.isPlaying,onTrackClick:this.$MusicStoryTrackListContainer1,uniqueId:this.props.uniqueId,titleUriList:this.props.titleUriList})};e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);
__d("SimpleMusicStoryCTA",["fbt","ChannelManager","DOM","MusicStoryAudioStore","MusicStoryBanzaiFeedLogger","MusicStoryEventLogger","MusicStoryLoggerEvents","URI","throttle"],(function(a,b,c,d,e,f,g){__p&&__p();var h=500;b("ChannelManager").startChannelManager();function a(a,c,d){"use strict";__p&&__p();this.onSpotifyClick=function(){b("MusicStoryBanzaiFeedLogger").logOutboundClick(this.$15);var a={cta_action:"webview"};this.logEvent(b("MusicStoryLoggerEvents").CTA_CLICK,a);a=new(b("URI"))(this.$16);var c=a.getQueryData();c.utm_source||(a=a.addQueryData({utm_source:"Facebook_SimpleMusicStories"}));c.utm_medium||(a=a.addQueryData({utm_medium:"sms"}));window.open(a)}.bind(this);this.onDefaultClick=function(){b("MusicStoryBanzaiFeedLogger").logOutboundClick(this.$15);var a=this.$20?{cta_action:"webview",beacon_url:b("MusicStoryAudioStore").getBeacons(this.$19).ctaClickOpen,clienttime:Date.now()}:{cta_action:"webview"};this.logEvent(b("MusicStoryLoggerEvents").CTA_CLICK,a);window.open(this.$16)}.bind(this);this.$1=d.album;this.$3=a;this.$9=c;this.$16=d.uri;this.$6=d.saved;this.$7=!1;this.$8=d.loggedIn;this.$2=d.appName;this.$11=!1;this.$15=d.ftkey;this.$19=d.uniqueId;this.$20=d.isDynamicUri;c=d.loggingData;c!==null&&(this.$4=new(b("MusicStoryEventLogger"))(c),this.$7=!0);switch(this.$2){case"Spotify":this.$13=g._("Play on {partnerName}",[g._param("partnerName",this.$2)]);this.$17="";this.$10=this.onSpotifyClick;break;case"iTunes":this.$13=g._("Get it on iTunes");this.$17="";this.$10=this.onDefaultClick;break;default:d=this.$2;this.$13=g._("Listen on {partnerName}",[g._param("partnerName",d)]);this.$17="";this.$10=this.onDefaultClick}b("DOM").setContent(this.$9,this.$13);a.addEventListener("click",b("throttle")(this.$10,h))}a.prototype.logEvent=function(a,b){"use strict";this.$7&&this.$4.logEvent(a,b)};e.exports=a}),null);
__d("SimpleMusicAudioControls.react",["cx","React","VideoPlaybackControl.react","VideoPlaybackTimer.react","VideoScrubber.react","VideoVolumeControl.react"],(function(a,b,c,d,e,f,g){a=function(a){var c="_1c7f _1c7g",d="_1c7f _2pvx",e="_1c7f _409j",f="_2w_u",g=a.playbackPosition-a.playbackDuration;g=b("React").createElement(b("VideoPlaybackTimer.react"),{className:"_5qsr",remainingTimestamp:Math.round(g),playbackPosTimestamp:a.playbackPosition});var h=b("React").createElement(b("VideoPlaybackControl.react"),{finishedPlaying:a.finishedPlaying,isPlaying:a.isPlaying,onPause:a.onPause,onPlay:a.onPlay,tabIndex:"0"}),i=b("React").createElement(b("VideoScrubber.react"),{bufferedPosition:a.bufferedPosition,onScrubBegin:a.onScrubBegin,onScrubEnd:a.onScrubEnd,playbackDuration:a.playbackDuration,playbackPosition:a.playbackPosition,tabIndex:"0"});a=b("React").createElement(b("VideoVolumeControl.react"),{isMuted:a.isMuted,onToggleMuted:a.onToggleMuted,onVolumeChange:a.onVolumeChange,volume:a.volume,tabIndex:"0"});return b("React").createElement("div",{className:f},b("React").createElement("div",{className:"_3t1r"},b("React").createElement("div",{className:"_2w_w"},b("React").createElement("div",{className:"_1c7d"},b("React").createElement("div",{className:c},h),b("React").createElement("div",{className:d},i),b("React").createElement("div",{className:e},g,a)))))};e.exports=a}),null);
__d("MusicStoryAudioControlsContainer.react",["FluxContainer","MusicStoryAudioStore","MusicStoryBaseContainer.react","React","SimpleMusicAudioControls.react"],(function(a,b,c,d,e,f){__p&&__p();var g;g=babelHelpers.inherits(a,b("MusicStoryBaseContainer.react"));g&&g.prototype;a.calculateState=function(a,c){"use strict";a=c.uniqueId;c=b("MusicStoryAudioStore").getStream(a);a=c.bufferedPosition;var d=c.isMuted,e=c.isPlaying,f=c.playbackPosition,g=c.volume,h=c.isFinished,i=c.duration,j=c.isDynamicUri;c=c.blockFetches;a={bufferedPosition:a,finishedPlaying:h,isMuted:d,isPlaying:e,playbackDuration:i,playbackPosition:f,volume:g,isDynamicUri:j,blockFetches:c};return a};a.prototype.render=function(){"use strict";return b("React").createElement(b("SimpleMusicAudioControls.react"),babelHelpers["extends"]({onPlay:this.play.bind(this),onPause:this.pause.bind(this),onScrubBegin:this.scrubBegin.bind(this),onScrubEnd:this.scrubEnd.bind(this),onToggleMuted:this.toggleMuted.bind(this),onVolumeChange:this.changeVolume.bind(this)},this.state))};function a(){"use strict";g.apply(this,arguments)}e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);